<div class="habitaciones-container">
  <h1 class="title">Administración de Habitaciones</h1>
  <div class="header-acciones">
    <button *ngIf="isSuperAdmin" class="btn btn-primary" (click)="openAddModal()">
      <span class="material-symbols-outlined icon-ms">add</span>
      Agregar Habitación
    </button>
  </div>
  <section class="filtros-card">
    <h4>Filtros de búsqueda</h4>
    <div class="filtros-grid">
      <div class="filtro">
        <label for="disponible">Disponibilidad</label>
        <div class="select-wrapper">
          <select id="disponible" [(ngModel)]="disponibleSeleccionado">
            <option value="">Todas</option>
            <option value="true">Disponibles</option>
            <option value="false">No disponibles</option>
          </select>
          <div class="chevron-icon">
            <span class="material-symbols-outlined">expand_more</span>
          </div>
        </div>
      </div>
      <div class="acciones">
        <button class="btn btn-primary" (click)="aplicarFiltros()">Aplicar</button>
      </div>
    </div>
  </section>

  <div class="estado">
    <div *ngIf="error" class="error">{{ error }}</div>
    <div *ngIf="habitacionesFiltradas.length === 0 && !error">No hay habitaciones que coincidan con el
      filtro.</div>
  </div>

  <section class="lista-habitaciones">
    <div *ngFor="let habitacion of habitacionesFiltradas" class="habitacion-card">
      <div class="card-left">
        <h3>Habitación #{{ habitacion.num }}</h3>
        <p class="descripcion">{{ habitacion.caracteristicas }}</p>
        <ul class="meta">
          <li class="meta-item">
            <span class="status-dot" [class.disponible]="habitacion.disponible"
                  [class.no-disponible]="!habitacion.disponible"></span>
            {{ habitacion.disponible ? 'Disponible' : 'No disponible' }}
          </li>
          <li class="meta-item">
            <span class="material-symbols-outlined">hotel</span>
            Hotel: {{ habitacion.codigo_hotel }}
          </li>
          <li class="meta-item">
            <span class="material-symbols-outlined">group</span>
            {{ habitacion.cant_huespedes }} Huéspedes
          </li>
          <li class="meta-item">
            <span class="material-symbols-outlined">payments</span>
            {{ habitacion.precio | number:'1.2-2' }} BOB
          </li>
        </ul>
      </div>
      <div class="card-right">
        <a class="btn btn-accent" [routerLink]="['/habitaciones', habitacion.num]">Ver Detalle</a>
        <div class="admin-actions" *ngIf="isSuperAdmin">
          <button class="btn btn-secondary btn-icon" (click)="openEditModal(habitacion)" aria-label="Editar Habitación">
            <span class="material-symbols-outlined">edit</span>
          </button>
          <button class="btn btn-danger btn-icon" (click)="onEliminarHabitacion(habitacion)" aria-label="Eliminar Habitación">
            <span class="material-symbols-outlined">delete</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <div class="modal-backdrop" *ngIf="showAddModal" (click)="closeAddModal()" aria-hidden="true"></div>
  <div class="modal-root" *ngIf="showAddModal" role="dialog" aria-modal="true" aria-labelledby="addHabitacionTitle"
       (click)="closeAddModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 id="addHabitacionTitle">Agregar habitación</h3>
        <button class="icon-btn" (click)="closeAddModal()" aria-label="Cerrar">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <form #addForm="ngForm" (ngSubmit)="saveAdd(addForm)" novalidate>
        <div class="modal-body">
          <label class="form-label" for="add_num">Número de Habitación *</label>
          <input id="add_num" name="num" type="text" class="form-input" [(ngModel)]="newModel.num" required />

          <label class="form-label" for="add_caracteristicas">Características *</label>
          <input id="add_caracteristicas" name="caracteristicas" type="text" class="form-input"
                 [(ngModel)]="newModel.caracteristicas" required />

          <label class="form-label" for="add_precio">Precio *</label>
          <input id="add_precio" name="precio" type="number" class="form-input" [(ngModel)]="newModel.precio" required />

          <label class="form-label" for="add_codigo_hotel">Código de Hotel *</label>
          <input id="add_codigo_hotel" name="codigo_hotel" type="number" class="form-input"
                 [(ngModel)]="newModel.codigo_hotel" required />

          <label class="form-label" for="add_cant_huespedes">Cantidad de Huéspedes *</label>
          <input id="add_cant_huespedes" name="cant_huespedes" type="number" class="form-input"
                 [(ngModel)]="newModel.cant_huespedes" required/>

          <div class="form-group checkbox-group">
            <input id="add_disponible" name="disponible" type="checkbox" [(ngModel)]="newModel.disponible" />
            <label for="add_disponible">Disponible</label>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="addForm.invalid || savingAdd">
            {{ savingAdd ? 'Guardando…' : 'Agregar habitación' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="showEditModal" (click)="closeEditModal()" aria-hidden="true"></div>
  <div class="modal-root" *ngIf="showEditModal" role="dialog" aria-modal="true" aria-labelledby="editHabitacionTitle"
       (click)="closeEditModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 id="editHabitacionTitle">Editar habitación</h3>
        <button class="icon-btn" (click)="closeEditModal()" aria-label="Cerrar">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <form #editForm="ngForm" (ngSubmit)="saveEdit(editForm)" novalidate *ngIf="editModel">
        <div class="modal-body">
          <label class="form-label" for="edit_num">Número de Habitación *</label>
          <input id="edit_num" name="num" type="text" class="form-input" [(ngModel)]="editModel.num" required />

          <label class="form-label" for="edit_caracteristicas">Características *</label>
          <input id="edit_caracteristicas" name="caracteristicas" type="text" class="form-input"
                 [(ngModel)]="editModel.caracteristicas" required />

          <label class="form-label" for="edit_precio">Precio *</label>
          <input id="edit_precio" name="precio" type="number" class="form-input" [(ngModel)]="editModel.precio" required />

          <label class="form-label" for="edit_codigo_hotel">Código de Hotel *</label>
          <input id="edit_codigo_hotel" name="codigo_hotel" type="number" class="form-input"
                 [(ngModel)]="editModel.codigo_hotel" required />

          <label class="form-label" for="edit_cant_huespedes">Cantidad de Huéspedes *</label>
          <input id="edit_cant_huespedes" name="cant_huespedes" type="number" class="form-input"
                 [(ngModel)]="editModel.cant_huespedes" required/>

          <div class="form-group checkbox-group">
            <input id="edit_disponible" name="disponible" type="checkbox" [(ngModel)]="editModel.disponible" />
            <label for="edit_disponible">Disponible</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || savingEdit">
            {{ savingEdit ? 'Guardando…' : 'Guardar cambios' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
