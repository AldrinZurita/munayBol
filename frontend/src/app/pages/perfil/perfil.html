<!-- Main container for the profile page -->
<div class="perfil-container">
  <h1 class="title">Mi Perfil</h1>

  <!-- Profile card -->
  <section *ngIf="usuario" class="perfil-card">
    <div class="perfil-header">
      <div class="avatar-wrapper">
        <img *ngIf="usuario.avatar_url; else avatarInicial"
             [src]="usuario.avatar_url"
             class="avatar-img"
             referrerpolicy="no-referrer"
             alt="avatar" />
        <ng-template #avatarInicial>
          <div class="avatar-placeholder">
            <span>{{ (usuario.nombre || usuario.correo).charAt(0).toUpperCase() }}</span>
          </div>
        </ng-template>
      </div>

      <div class="info-principal">
        <h2 class="nombre-usuario">{{ usuario.nombre }}</h2>
        <p class="rol-usuario">{{ usuario.rol | titlecase }}</p>
      </div>
    </div>

    <div class="perfil-body" *ngIf="!editando; else formEdicion">
      <div class="detalle-item">
        <span class="label">Correo Electrónico</span>
        <span class="valor">{{ usuario.correo }}</span>
      </div>
      <div class="detalle-item">
        <span class="label">País</span>
        <span class="valor">{{ usuario.pais }}</span>
      </div>
      <div class="detalle-item">
        <span class="label">Pasaporte</span>
        <span class="valor">{{ usuario.pasaporte }}</span>
      </div>
      <div *ngIf="usuario.fecha_creacion" class="detalle-item">
        <span class="label">Miembro Desde</span>
        <span class="valor">{{ usuario.fecha_creacion | date:'longDate' }}</span>
      </div>
      <div class="detalle-item">
        <span class="label">Estado de la Cuenta</span>
        <span class="valor" [ngClass]="{'activo': usuario.estado, 'inactivo': !usuario.estado}">
          {{ usuario.estado ? 'Activo' : 'Inactivo' }}
        </span>
      </div>

      <div class="acciones">
        <button class="btn-primario" (click)="activarEdicion()">Editar perfil</button>
      </div>
    </div>

    <ng-template #formEdicion>
      <form class="perfil-form" (ngSubmit)="guardarCambios()" autocomplete="off">
        <div class="campo">
          <label>Nombre</label>
          <input [(ngModel)]="form.nombre" name="nombre" required />
        </div>
        <div class="campo">
          <label>País</label>
          <input [(ngModel)]="form.pais" name="pais" />
        </div>
        <div class="campo">
          <label>Pasaporte</label>
          <input [(ngModel)]="form.pasaporte" name="pasaporte" />
        </div>
        <div class="campo">
          <label>Foto (URL)</label>
          <input [(ngModel)]="form.avatar_url" name="avatar_url" placeholder="https://..." />
          <small class="ayuda">Si iniciaste con Google/GitHub, se usa su foto; aquí puedes pegar otra URL si quieres.</small>
        </div>

        <div class="acciones">
          <button type="submit" class="btn-primario" [disabled]="guardando">Guardar</button>
          <button type="button" class="btn-secundario" (click)="cancelarEdicion()" [disabled]="guardando">Cancelar</button>
        </div>

        <div class="mensaje-error" *ngIf="errorGuardar">{{ errorGuardar }}</div>
      </form>
    </ng-template>
  </section>

  <!-- "Mis Reservas" section -->
  <section *ngIf="usuario" class="reservas-section">
    <h2>Mis Reservas</h2>

    <div *ngIf="cargandoReservas" class="estado">Cargando tus reservas...</div>
    <div *ngIf="errorReservas" class="estado error">{{ errorReservas }}</div>
    <div *ngIf="!cargandoReservas && reservas.length === 0 && !errorReservas" class="estado-vacio">
      <span class="material-symbols-outlined">luggage</span>
      <p>Aún no tienes ninguna reserva.</p>
      <a routerLink="/paquetes" class="btn-explorar">Explorar Paquetes</a>
    </div>

    <div *ngIf="reservas.length > 0" class="lista-reservas">
      <article *ngFor="let reserva of reservas" class="reserva-card">
        <div class="reserva-header">
          <h3>Reserva #{{ reserva.id_reserva }}</h3>
          <span class="status-badge" [ngClass]="{ 'activa': reserva.estado, 'cancelada': !reserva.estado }">
            {{ reserva.estado ? 'Activa' : 'Cancelada' }}
          </span>
        </div>
        <div class="reserva-body">
          <div class="detalle-reserva">
            <span class="material-symbols-outlined">bed</span>
            <p><strong>Habitación:</strong> {{ reserva.num_habitacion }}</p>
          </div>
          <div class="detalle-reserva">
            <span class="material-symbols-outlined">hotel</span>
            <p><strong>Hotel:</strong> {{ reserva.hotel?.nombre || ('ID: ' + reserva.codigo_hotel) }}</p>
          </div>
          <div class="detalle-reserva">
            <span class="material-symbols-outlined">calendar_month</span>
            <p><strong>Check-in:</strong> {{ reserva.fecha_reserva | date:'fullDate' }}</p>
          </div>
          <div class="detalle-reserva">
            <span class="material-symbols-outlined">event</span>
            <p><strong>Check-out:</strong> {{ reserva.fecha_caducidad | date:'fullDate' }}</p>
          </div>
        </div>
        <div class="reserva-footer">
          <a [routerLink]="['/reservas', reserva.id_reserva]" class="btn-detalle">Ver Detalle</a>
        </div>
      </article>
    </div>
  </section>
</div>
