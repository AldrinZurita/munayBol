<div class="admin-usuarios-container">
  <div class="page-bg" aria-hidden="true"></div>
  <div class="container">
    <header class="page-header">
      <div class="header-content">
        <h1 class="page-title">
          <span class="material-symbols-outlined">manage_accounts</span>
          Gesti√≥n de Usuarios
        </h1>
        <p class="page-description">Administra usuarios, roles y permisos</p>
      </div>
      <div class="stats-cards">
        <div class="stat-card">
          <span class="stat-number">{{ usuarios.length }}</span>
          <span class="stat-label">Total Usuarios</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">{{ totalAdmins }}</span>
          <span class="stat-label">Administradores</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">{{ totalActive }}</span>
          <span class="stat-label">Activos</span>
        </div>
      </div>
    </header>
    <div class="filters-section">
      <div class="search-box">
        <span class="material-symbols-outlined search-icon">search</span>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Buscar por nombre o correo..."
          class="search-input">
      </div>

      <div class="filter-group">
        <label for="filterRole">Rol:</label>
        <select id="filterRole" [(ngModel)]="filterRole" class="filter-select">
          <option value="all">Todos</option>
          <option value="superadmin">Administrador</option>
          <option value="usuario">Usuario</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filterStatus">Estado:</label>
        <select id="filterStatus" [(ngModel)]="filterStatus" class="filter-select">
          <option value="all">Todos</option>
          <option value="active">Activos</option>
          <option value="inactive">Inactivos</option>
        </select>
      </div>
    </div>
    <div class="estado error" *ngIf="error" style="margin: 1rem 0; text-align: center; color: red; font-weight: 600;">
      {{ error }}
    </div>
    <div class="users-table-container" *ngIf="!error">
      <div class="table-wrapper">
        <table class="users-table" *ngIf="filteredUsuarios.length > 0">
          <thead>
          <tr>
            <th>Usuario</th>
            <th>Correo</th>
            <th>Pa√≠s</th>
            <th>Rol</th>
            <th>Estado</th>
            <th>Fecha Registro</th>
            <th>Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let usuario of filteredUsuarios" class="user-row">
            <td>
              <div class="user-cell">
                <div class="avatar">
                  <img *ngIf="usuario.avatar_url" [src]="usuario.avatar_url" [alt]="usuario.nombre">
                  <span *ngIf="!usuario.avatar_url" class="avatar-initials">
                      {{ getInitials(usuario.nombre) }}
                    </span>
                </div>
                <div class="user-info">
                  <span class="user-name">{{ usuario.nombre }}</span>
                  <span class="user-id">ID: {{ usuario.id }}</span>
                </div>
              </div>
            </td>
            <td>
              <span class="user-email">{{ usuario.correo }}</span>
            </td>
            <td>
              <span class="user-country">{{ usuario.pais }}</span>
            </td>
            <td>
                <span class="badge" [ngClass]="getRoleBadgeClass(usuario.rol)">
                  {{ usuario.rol === 'superadmin' ? 'Admin' : 'Usuario' }}
                </span>
            </td>
            <td>
                <span class="badge" [ngClass]="getStatusBadgeClass(usuario.estado)">
                  {{ usuario.estado ? 'Activo' : 'Inactivo' }}
                </span>
            </td>
            <td>
              <span class="date">{{ usuario.fecha_creacion | date:'shortDate' }}</span>
            </td>
            <td>
              <div class="actions">
                <button
                  class="action-btn view"
                  (click)="viewUserProfile(usuario)"
                  title="Ver perfil">
                  <span class="material-symbols-outlined">visibility</span>
                </button>

                <button
                  class="action-btn edit"
                  [class.downgrade]="usuario.rol === 'superadmin'"
                  (click)="changeUserRole(usuario, usuario.rol === 'superadmin' ? 'usuario' : 'superadmin')"
                  [title]="usuario.rol === 'superadmin' ? 'Quitar rol admin' : 'Promover a admin'">
                    <span class="material-symbols-outlined">
                      {{ usuario.rol === 'superadmin' ? 'person_remove' : 'admin_panel_settings' }}
                    </span>
                </button>

                <button
                  class="action-btn toggle"
                  [class.deactivate]="usuario.estado"
                  (click)="toggleUserStatus(usuario)"
                  [title]="usuario.estado ? 'Desactivar usuario' : 'Activar usuario'">
                    <span class="material-symbols-outlined">
                      {{ usuario.estado ? 'block' : 'check_circle' }}
                    </span>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="empty-state" *ngIf="filteredUsuarios.length === 0 && !error">
          <span class="empty-icon">üë•</span>
          <h3>No se encontraron usuarios</h3>
          <p>Intenta ajustar los filtros de b√∫squeda</p>
        </div>
      </div>
    </div>
  </div>
</div>
