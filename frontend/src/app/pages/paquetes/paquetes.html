<div class="paquetes-container">
  <h1>Paquetes Turísticos</h1>

  <div class="filtros">
    <h4>Filtros de búsqueda</h4>
    <div class="filtro-row">
      <label>Disponibilidad:</label>
      <select [(ngModel)]="disponibleSeleccionado">
        <option value="">Todas</option>
        <option value="true">Disponibles</option>
        <option value="false">No disponibles</option>
      </select>
    </div>
    <div class="filtro-row">
      <label>Departamento:</label>
      <select [(ngModel)]="departamentoSeleccionado">
        <option value="">Todos</option>
        <option *ngFor="let dep of departamentos" [value]="dep">{{ dep }}</option>
      </select>
    </div>
    <div class="filtro-row">
      <label>Tipo de paquete:</label>
      <select [(ngModel)]="tipoSeleccionado">
        <option value="">Todos</option>
        <option value="aventura">Aventura</option>
        <option value="cultural">Cultural</option>
        <option value="naturaleza">Naturaleza</option>
        <option value="historico">Histórico</option>
        <option value="gastronomico">Gastronómico</option>
      </select>
    </div>
    <button class="aplicar-btn" (click)="aplicarFiltros()">Aplicar Filtros</button>
  </div>

  <!-- FORMULARIO DE CREACIÓN SOLO PARA SUPERADMIN -->
  <div *ngIf="isSuperAdmin" class="form-crear-paquete">
    <h2>Crear Paquete</h2>
    <form (ngSubmit)="crearPaquete()" #paqueteForm="ngForm">
      <label>Nombre:</label>
      <input type="text" [(ngModel)]="paqueteNuevo.nombre" name="nombre" required />

      <label>Tipo:</label>
      <input type="text" [(ngModel)]="paqueteNuevo.tipo" name="tipo" required />

      <label>Precio:</label>
      <input type="number" [(ngModel)]="paqueteNuevo.precio" name="precio" required />

      <label>ID Hotel:</label>
      <input type="number" [(ngModel)]="paqueteNuevo.id_hotel" name="id_hotel" required />

      <label>ID Lugar Turístico:</label>
      <input type="number" [(ngModel)]="paqueteNuevo.id_lugar" name="id_lugar" required />

      <label>
        <input type="checkbox" [(ngModel)]="paqueteNuevo.estado" name="estado" />
        Disponible
      </label>

      <button type="submit">Guardar Paquete</button>
    </form>
  </div>
  <!-- FIN FORMULARIO DE CREACIÓN -->

  <p *ngIf="cargando">Cargando paquetes...</p>
  <p *ngIf="error">{{ error }}</p>
  <p *ngIf="!cargando && !error && paquetesFiltrados.length === 0">No hay paquetes que coincidan con el filtro.</p>

  <div class="lista-paquetes">
    <ng-container *ngFor="let paquete of paquetesFiltrados">
      <div class="paquete-card">
        <div class="paquete-header">
          <h3 class="paquete-nombre">{{ paquete.nombre }}<span *ngIf="paquete.hotel"> + {{ paquete.hotel.nombre }}</span></h3>
          <span class="paquete-etiqueta">{{ paquete.tipo | titlecase }}</span>
        </div>
        <div class="paquete-meta">
          <p class="meta-item" *ngIf="paquete.hotel"><strong>Ubicación:</strong> {{ paquete.hotel.ubicacion }}</p>
          <p class="meta-item"><strong>Departamento:</strong>
            {{ paquete.hotel?.departamento || paquete.lugar?.departamento }}
          </p>
        </div>
        <p class="paquete-descripcion">{{ paquete.lugar?.descripcion }}</p>
        <div class="paquete-footer">
          <span class="paquete-precio">{{ paquete.precio }} BOB</span>
          <a class="ver-detalle-btn" [routerLink]="['/paquetes', paquete.id_paquete]">Ver Detalles</a>
          <button class="editar-btn" (click)="onEditarPaquete(paquete)" *ngIf="isSuperAdmin">Editar</button>
          <button class="btn btn-danger" (click)="onEliminarPaquete(paquete)" *ngIf="isSuperAdmin">Eliminar</button>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<!-- MODAL PARA EDITAR -->
<div class="modal-overlay" *ngIf="mostrarModalEditar" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar Paquete Turístico</h2>
      <button class="close-btn" (click)="cerrarModal()">&times;</button>
    </div>
    <form class="form-editar" (ngSubmit)="guardarEdicion()">
      <div class="form-group">
        <label>Nombre:</label>
        <input type="text" [(ngModel)]="paqueteEditando!.nombre" name="nombre" required>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Tipo de Paquete:</label>
          <select [(ngModel)]="paqueteEditando!.tipo" name="tipo" required>
            <option value="">Seleccionar tipo</option>
            <option value="aventura">Aventura</option>
            <option value="cultural">Cultural</option>
            <option value="naturaleza">Naturaleza</option>
            <option value="historico">Histórico</option>
            <option value="gastronomico">Gastronómico</option>
          </select>
        </div>
        <div class="form-group">
          <label>Precio (BOB):</label>
          <input type="number" [(ngModel)]="paqueteEditando!.precio" name="precio" step="0.01" required>
        </div>
      </div>
      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="paqueteEditando!.estado" name="estado">
          Paquete disponible
        </label>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
        <button type="submit" class="btn-guardar">Guardar Cambios</button>
      </div>
    </form>
  </div>
</div>