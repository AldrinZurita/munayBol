<!-- Main container for the page -->
<div class="lugares-container">
  <h1 class="title">Lugares Turísticos de Bolivia</h1>

  <!-- Header for main actions, like the add button -->
  <div class="header-acciones">
    <button *ngIf="isSuperAdmin" class="btn btn-primary" (click)="openAddModal()">
      <span class="material-symbols-outlined icon-ms">add</span>
      Agregar Lugar Turístico
    </button>
  </div>

  <!-- Filters card section -->
  <section class="filtros-card">
    <h4>Filtros de búsqueda</h4>
    <div class="filtros-grid solo-uno">
      <!-- Filtro 1: Departamento -->
      <div class="filtro">
        <label for="ciudad">Departamento</label>
        <div class="select-wrapper">
          <select id="ciudad" [(ngModel)]="ciudadSeleccionada">
            <option value="">Todos los departamentos</option>
            <option *ngFor="let ciudad of ciudades" [value]="ciudad">{{ ciudad }}</option>
          </select>
          <div class="chevron-icon">
            <span class="material-symbols-outlined">expand_more</span>
          </div>
        </div>
      </div>
      <!-- Botón de acción para aplicar filtros -->
      <div class="acciones">
        <button class="btn btn-primary" (click)="aplicarFiltros()">Aplicar</button>
      </div>
    </div>
  </section>

  <!-- Status display for loading, errors, or no results -->
  <div class="estado" role="status" aria-live="polite">
    <div *ngIf="cargando">Cargando lugares…</div>
    <div *ngIf="error" class="error">{{ error }}</div>
    <div *ngIf="!cargando && lugaresFiltrados.length === 0 && !error">
      No hay lugares que coincidan con el filtro.
    </div>
  </div>

  <!-- List of tourist location cards -->
  <section class="lista">
    <article *ngFor="let l of lugaresFiltrados; trackBy: trackByLugar" class="card-lugar">
      <!-- Left column: Information -->
      <div class="card-left">
        <div *ngIf="l.url_image_lugar_turistico" class="imagen-lugar">
          <img [src]="l.url_image_lugar_turistico" [alt]="'Imagen de ' + l.nombre" />
        </div>
        <h3 class="lugar-nombre">{{ l.nombre }}</h3>
        <ul class="meta">
          <li class="meta-item">
            <span class="material-symbols-outlined">location_on</span>
            {{ l.departamento }}
          </li>
          <li class="meta-item" *ngIf="l.tipo">
            <span class="material-symbols-outlined">sell</span>
            {{ l.tipo }}
          </li>
        </ul>
        <p class="descripcion" *ngIf="l.ubicacion">{{ l.ubicacion }}</p>
      </div>
      <!-- Right column: Action buttons -->
      <div class="card-right">
        <a class="btn btn-accent" [routerLink]="['/lugares-turisticos', l.id_lugar]">Ver Detalles</a>
        <!-- Botones de administración que solo se muestran si isSuperAdmin es true -->
        <button *ngIf="isSuperAdmin" class="btn btn-secondary" (click)="openEditModal(l)">Editar</button>
        <button *ngIf="isSuperAdmin" class="btn btn-danger" (click)="onEliminarLugar(l)">Eliminar</button>
      </div>
    </article>
  </section>
</div>

  <!-- Edit Modal -->
  <div class="modal-backdrop" *ngIf="showEditModal" (click)="closeEditModal()" aria-hidden="true"></div>
  <div class="modal-root" *ngIf="showEditModal" role="dialog" aria-modal="true" aria-labelledby="editLugarTitle" (click)="closeEditModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 id="editLugarTitle">Editar lugar</h3>
        <button class="icon-btn" (click)="closeEditModal()" aria-label="Cerrar">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <form #editForm="ngForm" (ngSubmit)="saveEdit(editForm)" novalidate>
        <div class="modal-body">
          <label class="form-label" for="edit_nombre">Nombre *</label>
          <input id="edit_nombre" name="nombre" type="text" class="form-input" [(ngModel)]="editModel.nombre" required />
          <label class="form-label" for="edit_departamento">Departamento *</label>
          <input id="edit_departamento" name="departamento" type="text" class="form-input" [(ngModel)]="editModel.departamento" required />
          <label class="form-label" for="edit_tipo">Tipo *</label>
          <input id="edit_tipo" name="tipo" type="text" class="form-input" [(ngModel)]="editModel.tipo" required />
          <label class="form-label" for="edit_ubicacion">Ubicación *</label>
          <textarea id="edit_ubicacion" name="ubicacion" class="form-textarea" rows="3" [(ngModel)]="editModel.ubicacion" required></textarea>
          <label class="form-label" for="edit_horario">Horario</label>
          <input id="edit_horario" name="horario" type="text" class="form-input" [(ngModel)]="editModel.horario" />
          <label class="form-label" for="edit_descripcion">Descripción</label>
          <textarea id="edit_descripcion" name="descripcion" class="form-textarea" rows="3" [(ngModel)]="editModel.descripcion"></textarea>
          <label class="form-label" for="edit_img">URL de imagen</label>
          <input id="edit_img" name="img" type="url" class="form-input" [(ngModel)]="editModel.url_image_lugar_turistico" />
          <div class="img-preview" *ngIf="editModel.url_image_lugar_turistico">
            <img [src]="editModel.url_image_lugar_turistico" alt="Vista previa" (error)="onImageError($event)" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid || savingEdit">
            {{ savingEdit ? 'Guardando…' : 'Guardar cambios' }}
          </button>
        </div>
      </form>
    </div>
    <form #addForm="ngForm" (ngSubmit)="saveNewLugar(addForm)" novalidate>
      <div class="modal-body">
        <label class="form-label" for="add-nombre">Nombre *</label>
        <input id="add-nombre" name="nombre" type="text" class="form-input" [(ngModel)]="addModel.nombre" required />
        <label class="form-label" for="add-departamento">Departamento *</label>
        <input id="add-departamento" name="departamento" type="text" class="form-input" [(ngModel)]="addModel.departamento" required />
        <label class="form-label" for="add-tipo">Tipo *</label>
        <input id="add-tipo" name="tipo" type="text" class="form-input" [(ngModel)]="addModel.tipo" required />
        <label class="form-label" for="add-ubicacion">Ubicación *</label>
        <textarea id="add-ubicacion" name="ubicacion" class="form-textarea" rows="3" [(ngModel)]="addModel.ubicacion" required></textarea>
        <label class="form-label" for="add-horario">Horario</label>
        <input id="add-horario" name="horario" type="text" class="form-input" [(ngModel)]="addModel.horario" />
        <label class="form-label" for="add-descripcion">Descripción</label>
        <textarea id="add-descripcion" name="descripcion" class="form-textarea" rows="3" [(ngModel)]="addModel.descripcion"></textarea>
        <label class="form-label" for="add-img">URL de imagen</label>
        <input id="add-img" name="img" type="url" class="form-input" [(ngModel)]="addModel.url_image_lugar_turistico" />
        <div class="img-preview" *ngIf="addModel.url_image_lugar_turistico">
          <img [src]="addModel.url_image_lugar_turistico" alt="Vista previa" (error)="onImageError($event)" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddModal(false)">Cancelar</button>
        <button type="submit" class="btn btn-primary" [disabled]="addForm.invalid || savingAdd">
          {{ savingAdd ? 'Guardando…' : 'Crear Lugar' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Add Modal -->
  <div class="modal-backdrop" *ngIf="showAddModal" (click)="closeAddModal()" aria-hidden="true"></div>
  <div class="modal-root" *ngIf="showAddModal" role="dialog" aria-modal="true" aria-labelledby="addLugarTitle" (click)="closeAddModal()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 id="addLugarTitle">Agregar Nuevo Lugar</h3>
        <button class="icon-btn" (click)="closeAddModal()" aria-label="Cerrar">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <form #addForm="ngForm" (ngSubmit)="saveNewLugar(addForm)" novalidate>
        <div class="modal-body">
          <label class="form-label" for="add_id_lugar">ID Lugar *</label>
          <input id="add_id_lugar" name="id_lugar" type="number" class="form-input" [(ngModel)]="addModel.id_lugar" required />
          <label class="form-label" for="add-nombre">Nombre *</label>
          <input id="add-nombre" name="nombre" type="text" class="form-input" [(ngModel)]="addModel.nombre" required />
          <label class="form-label" for="add-departamento">Departamento *</label>
          <input id="add-departamento" name="departamento" type="text" class="form-input" [(ngModel)]="addModel.departamento" required />
          <label class="form-label" for="add-tipo">Tipo *</label>
          <input id="add-tipo" name="tipo" type="text" class="form-input" [(ngModel)]="addModel.tipo" required />
          <label class="form-label" for="add-ubicacion">Ubicación *</label>
          <textarea id="add-ubicacion" name="ubicacion" class="form-textarea" rows="3" [(ngModel)]="addModel.ubicacion" required></textarea>
          <label class="form-label" for="add-horario">Horario</label>
          <input id="add-horario" name="horario" type="text" class="form-input" [(ngModel)]="addModel.horario" />
          <label class="form-label" for="add-descripcion">Descripción</label>
          <textarea id="add-descripcion" name="descripcion" class="form-textarea" rows="3" [(ngModel)]="addModel.descripcion"></textarea>
          <label class="form-label" for="add-img">URL de imagen</label>
          <input id="add-img" name="img" type="url" class="form-input" [(ngModel)]="addModel.url_image_lugar_turistico" />
          <div class="img-preview" *ngIf="addModel.url_image_lugar_turistico">
            <img [src]="addModel.url_image_lugar_turistico" alt="Vista previa" (error)="onImageError($event)" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="addForm.invalid || savingAdd">
            {{ savingAdd ? 'Guardando…' : 'Crear Lugar' }}
          </button>
        </div>
      </form>
    </div>
  </div>

